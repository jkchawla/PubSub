<!DOCTYPE html>
<html>
    <head>
        <title></title>
        <meta name="viewport" content="initial-scale=1.0">
        <meta charset="utf-8">
        <style>
            /* Always set the map height explicitly to define the size of the div
            //    * element that contains the map. */
            #map {
                height: 100%;
            }
            /* Optional: Makes the sample page fill the window. */
            html, body {
                height: 100%;
                margin: 0;
                padding: 0;
            }
        </style>

    </head>
    <body>
        <form action="add/sub" method="post">
            <input type="submit" name="addsub" value="addsub" />
        </form>
        <!--
<div>
<strong>Start: </strong>
<select id="start" onchange="calcRoute();">
<option value="41.878113,-87.629799">Chicago</option>
<option value="38.627003,-90.199402">St Louis</option>
<option value="42.360081,-71.058884">Boston</option>
<option value="40.712776,-74.005974">New York City</option>
<option value="32.776665,-96.796989">Dallas</option>
<option value="41.499321,-81.694359">Cleveland</option>
<option value="39.952583,-75.165222">Philadelphia</option>
<option value="33.748997,-84.387985">Atlanta</option>
<option value="44.977753,-93.265015">Minneapolis</option>
<option value="37.540726,-77.436050">Richmond</option>
<option value="41.256538,-95.934502">Omaha</option>
<option value="37.774929,-122.419418">San Francisco</option>
<option value="39.099728,-94.578568">Kansas City</option>
<option value="34.052235,-118.243683">Los Angeles</option>
</select>
<strong>End: </strong>
<select id="end" onchange="calcRoute();">
<option value="41.878113,-87.629799">Chicago</option>
<option value="38.627003,-90.199402">St Louis</option>
<option value="42.360081,-71.058884">Boston</option>
<option value="40.712776,-74.005974">New York City</option>
<option value="32.776665,-96.796989">Dallas</option>
<option value="41.499321,-81.694359">Cleveland</option>
<option value="39.952583,-75.165222">Philadelphia</option>
<option value="33.748997,-84.387985">Atlanta</option>
<option value="44.977753,-93.265015">Minneapolis</option>
<option value="37.540726,-77.436050">Richmond</option>
<option value="41.256538,-95.934502">Omaha</option>
<option value="37.774929,-122.419418">San Francisco</option>
<option value="39.099728,-94.578568">Kansas City</option>
<option value="34.052235,-118.243683">Los Angeles</option>
</select>
</div>
-->
        <div id="map"></div>
        <script>

            // Initialize the map
            function initMap() {
                const directionsService = new google.maps.DirectionsService();
                const directionsDisplay = new google.maps.DirectionsRenderer();
                const chicago = new google.maps.LatLng(41.878113, -87.629799);
                const mapOptions = {
                    zoom:7,
                    center: chicago
                }
                const map = new google.maps.Map(document.getElementById('map'), mapOptions);
                directionsDisplay.setMap(map);
            }

            // Change the Server JSON into Client Usable JSON to Display
            function typecastRoutes(routes){
                routes.forEach(function(route){
                    route.bounds = asBounds(route.bounds);
                    // I don't think `overview_path` is used but it exists on the
                    // response of DirectionsService.route()
                    route.overview_path = asPath(route.overview_polyline);

                    route.legs.forEach(function(leg){
                        leg.start_location = asLatLng(leg.start_location);
                        leg.end_location   = asLatLng(leg.end_location);

                        leg.steps.forEach(function(step){
                            step.start_location = asLatLng(step.start_location);
                            step.end_location   = asLatLng(step.end_location);
                            step.path = asPath(step.polyline);
                        });

                    });
                });
                return routes;
            }

            function asBounds(boundsObject){
                return new google.maps.LatLngBounds(asLatLng(boundsObject.southwest),
                                                    asLatLng(boundsObject.northeast));
            }

            function asLatLng(latLngObject){
                return new google.maps.LatLng(latLngObject.lat, latLngObject.lng);
            }

            function asPath(encodedPolyObject){
                return google.maps.geometry.encoding.decodePath( encodedPolyObject.points );
            }

            //Render the Directions and Markers using Server JSON
            function renderDirections(map, response, input, marker, weather){
                const renderer = new google.maps.DirectionsRenderer();
                renderer.setOptions({
                    directions : {
                        routes : typecastRoutes(response.routes),
                        request : input
                    },
                    draggable : false,
                    map : map,
                    suppressMarkers: true
                });
                getAllWeather(marker, map, weather)
            }

            //Add a marker with weather information to map
            function placeMarker(input, info, ap) {
                let infowindow = new google.maps.InfoWindow({
                    content: info
                });

                let marker = new google.maps.Marker({
                    position: input,
                    map: ap,
                    title: 'Rych Routes Marker'
                });

                marker.addListener('click', function() {
                    infowindow.open(ap, marker);
                });
            }

            //Add all the markers with corresponding weather information to map
            function getAllWeather(input, map, weather) {
                for (let i = 0; i < input.length; ++i) {
                    placeMarker(asLatLng(input[i]), weather[i], map)
                }
            }

            function getaddPublisher(){
                const xhr = new XMLHttpRequest();

                xhr.open("POST", "http://localhost:8000/", true);
                xhr.setRequestHeader("content-type", "application/json");
                xhr.setRequestHeader("cache-control", "no-cache");
                
                let name = document.getElementById('name').value;
                let topic = document.getElementById('topic').value;
                let description = document.getElementById('textarea').value;

                let sendObject=JSON.stringify({
                    'name':name,
                    'topic': topic,
                    'description': description
                });

                xhr.responseType = 'json';

                xhr.onload = function (e) {
                    if (xhr.readyState === xhr.DONE) {
                        if (xhr.status === 200) {
                            renderDirections(map, xhr.response.answer, input, xhr.response.marker, xhr.response.weather);
                        }
                    }
                };
                xhr.onerror = function (e) {
                    console.error(xhr.statusText);
                };
                xhr.send(sendObject);
            }

            //Query Backend for Route, Marker, and Weather Information
            function getRoute(start, end) {
                const xhr = new XMLHttpRequest();

                xhr.open("POST", "http://localhost:8000/", true);
                xhr.setRequestHeader("content-type", "application/json");
                xhr.setRequestHeader("cache-control", "no-cache");

                let sendObject=JSON.stringify({
                    "name": start,
                    "end": end
                });

                xhr.responseType = 'json';

                xhr.onload = function (e) {
                    if (xhr.readyState === xhr.DONE) {
                        if (xhr.status === 200) {
                            renderDirections(map, xhr.response.answer, input, xhr.response.marker, xhr.response.weather);
                        }
                    }
                };
                xhr.onerror = function (e) {
                    console.error(xhr.statusText);
                };
                xhr.send(sendObject);
            }
            {
                answer: asas,
                marker: asasa,
                weather: asa
            }



            //Runs code when there's a change in inputs
            function calcRoute() {
                let start = document.getElementById('start').value;
                let end = document.getElementById('end').value;
                getRoute(start, end);
            }

            // Line 200 REPLACE THE API KEY WITH YOUR API KEY

        </script>

    </body>
</html>
